<div class="row">
    <div class="col-md-12">
        <h4 class="text-danger">查询条件</h4>
        <form class="form-horizontal" id="fuzzy_form">
        	<div class="row">
	        	<div class="col-md-6">
		            <div class="form-group">
		                <label class="col-sm-3 control-label no-padding-right" for="user_id"> 用户ID </label>
		                <div class="col-sm-9">
		                    <input id="user_id" class="col-xs-10 col-sm-5" type="text" name="user_id">
		                </div>
		            </div>
            	</div>
            	<div class="col-md-6">
            		<div class="form-group">
		                <label class="col-sm-3 control-label no-padding-right" for="coin_id"> 币种代码 </label>
		                <div class="col-sm-9">
		                    <select class="col-xs-10 col-sm-5" id="coin_id" name="coin_id">
		                        <option value="CNY">CNY</option>
								<?php
			    				foreach ($data as $coin_id=>$coin)
    							{
        							$coinAttrs = explode("__", $coin);
        							$coin_code = strtoupper($coinAttrs[0]);
								?>
		                        <option value="<?=$coin_id?>"><?=$coin_code?></option>
								<?php
		    					}
								?>
		                    </select>
		                </div>
		            </div>
            	</div>
        	</div>
        	<div class="space-4"></div>
			<div class="row">
				<div class="col-md-6">
					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right" for="order_id">订单ID </label>
		                <div class="col-sm-9">
		                    <input id="order_id" class="col-xs-10 col-sm-5" type="text" name="order_id">
		                </div>
		            </div>
				</div>
				<div class="col-md-6">
					<div class="form-group">
		                <label class="col-sm-3 control-label no-padding-right"> 时间范围 </label>
		                <div class="col-sm-4">
		                    <div class="input-group input-group-sm">
		                        <input type="text" placeholder="开始时间" class="form-control datepicker_start"
		                               id="start_time" name="start_time">
								<span class="input-group-addon datepicker-addon" data-target="start_time">
									<i class="icon-legal icon-large"></i>
								</span>
		                    </div>
		                </div>
		                <div class="col-sm-1">
		                    <i class="icon-angle-left icon-large"></i>
		                </div>
		                <div class="col-sm-4">
		                    <div class="input-group input-group-sm">
		                        <input type="text" placeholder="结束时间" class="form-control datepicker_end"
		                               id="end_time" name="end_time">
								<span class="input-group-addon datepicker-addon" data-target="end_time">
									<i class="icon-legal icon-large"></i>
								</span>
		                    </div>
		                </div>
		            </div>
				</div>
			</div>
            <div class="space-4"></div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right" for="flag">订单状态</label>
                        <div class="col-sm-9">
                            <select id="flag" class="col-xs-10 col-sm-5" name="flag">
                                <option value="-1">所有</option>
                                <option value="0">失败</option>
                                <option value="1" selected>处理中</option>
                                <option value="2">已汇出</option>
                                <option value="3">已到账</option>
                                <option value="4">已取消</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
			<div class="row">
				 <div class="clearfix form-actions">
	                <div class="col-md-offset-3 col-md-9">
	                    <button class="btn btn-info" type="button" id="fuzzy_submit">
	                        <i class="icon-search bigger-110"></i> 开始搜索
	                    </button>
	                    &nbsp; &nbsp; &nbsp;
	                    <button class="btn" type="reset">
	                        <i class="icon-undo bigger-110"></i> 重置
	                    </button>
	                </div>
	            </div>
			</div>
        </form>
    </div>
</div>
<div class="row">
    <div class="col-md-12" id="withdrawal_list"></div>
</div>
<script>
    $(function () {
        $(".datepicker_start").datepicker({
            showOtherMonths: true,
            selectOtherMonths: false,
            dateFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true
        }).datepicker("setDate", new Date());
        
        $(".datepicker_end").datepicker({
            showOtherMonths: true,
            selectOtherMonths: false,
            dateFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true
        }).datepicker("setDate", new Date( (new Date).getTime() + 1*24*60*60*1000));
        

        $(".datepicker-addon").click(function () {
            $("#" + $(this).data("target")).val("");
        });

        var start_search = function($this) {
            $this.find("i").removeClass("icon-search").addClass("icon-refresh icon-spin");
        }
        var end_search = function($this) {
            return function(data) {
                $("#withdrawal_list").html(data);
                $this.find("i").removeClass("icon-refresh icon-spin").addClass("icon-search");
            }
        }

        $("#fuzzy_submit").click(function () {
            var $this = $(this);
            start_search($this);
            $.post("?c=admin&a=withdrawalList",
                    $("#fuzzy_form").serialize(),
                    end_search($this))
        })
       
    });
    
    function confirmwithdrawal(order_id)
    {
    	$.post('?c=admin&a=updatewithdrawal', {
	      	'order_id' : order_id
    	}).done(function(response) {
	    	var jsonObj = eval( "(" + response + ")" );
	      	if (jsonObj.success == true) {
	      		alert("充值确认成功");
	      		var $this = $("#"+order_id);
	      		$this.remove();
	      	} else {
	        	alert("充值确认成功, 请重试!"+jsonObj.error);
	      	}
	    });
    }
</script>
